<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Campanion Live</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background:#0A1A2F; color:#F0F4F8; margin:0; display:flex; justify-content:center; }
    .wrap { width: 92%; max-width: 900px; margin: 24px auto; }
    .card { background:#102A43; border:1px solid #1C3A57; border-radius:12px; padding:16px; }
    input, button { padding:10px; border-radius:8px; border:1px solid #1C3A57; background:#1C3A57; color:#F0F4F8; }
    button { background:#1FA97B; border:none; cursor:pointer; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .row > * { flex: 1; min-width: 180px; }
    #chatUI { display:none; margin-top:14px; }
    #messages { list-style:none; padding:0; margin:0; height: 380px; overflow:auto; border:1px solid #1C3A57; border-radius:10px; }
    #messages li { padding:10px; border-bottom:1px solid #1C3A57; }
    .muted { color:#9FB3C8; font-size: 13px; }
    .err { color:#ffb4b4; margin-top:10px; }
    .ok { color:#9ff5d8; margin-top:10px; }
    form { margin-top:10px; display:flex; gap:10px; }
    form input { flex:1; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>ðŸ’¬ Campanion Live</h2>

    <div class="card" id="joinCard">
      <div class="row">
        <div>
          <label class="muted">Your name</label><br/>
          <input id="name" type="text" placeholder="Eliana" />
        </div>
        <div>
          <label class="muted">Room code</label><br/>
          <input id="code" type="text" placeholder="PINE123" />
        </div>
        <div style="display:flex; align-items:flex-end;">
          <button id="joinBtn">Join room</button>
        </div>
      </div>
      <div class="muted" style="margin-top:10px;">
        Try codes: <b>PINE123</b>, <b>LAKE777</b>, <b>CAMP999</b>
      </div>
      <div id="status" class="err" style="display:none;"></div>
    </div>

    <div class="card" id="chatUI">
      <div class="muted" id="roomLabel"></div>
      <ul id="messages"></ul>

      <form id="chatForm">
        <input id="msg" type="text" placeholder="Type a message..." autocomplete="off" />
        <button type="submit">Send</button>
      </form>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
  <script>
    // Connect to local server for now
    const socket = io("http://localhost:3000", { transports: ["websocket"] });

    const joinBtn = document.getElementById("joinBtn");
    const statusEl = document.getElementById("status");
    const chatUI = document.getElementById("chatUI");
    const joinCard = document.getElementById("joinCard");
    const roomLabel = document.getElementById("roomLabel");
    const messages = document.getElementById("messages");
    const chatForm = document.getElementById("chatForm");
    const msgInput = document.getElementById("msg");

    function setStatus(text, ok=false) {
      statusEl.style.display = "block";
      statusEl.className = ok ? "ok" : "err";
      statusEl.textContent = text;
    }

    function addLine(text, muted=false) {
      const li = document.createElement("li");
      li.textContent = text;
      if (muted) li.style.opacity = 0.8;
      messages.appendChild(li);
      messages.scrollTop = messages.scrollHeight;
    }

    joinBtn.onclick = () => {
      const name = document.getElementById("name").value.trim() || "Anonymous";
      const code = document.getElementById("code").value.trim().toUpperCase();

      if (!code) return setStatus("Enter a room code.");
      statusEl.style.display = "none";

      socket.emit("joinRoom", { name, code });
    };

    socket.on("invalidRoom", () => {
      setStatus("Invalid room code. Try PINE123 / LAKE777 / CAMP999");
    });

    socket.on("joined", (code) => {
      joinCard.style.display = "none";
      chatUI.style.display = "block";
      roomLabel.textContent = "Room: " + code;
      addLine("âœ… Joined room " + code, true);
    });

    socket.on("system", (text) => addLine("â€¢ " + text, true));

    socket.on("chat", ({ name, text }) => {
      addLine(name + ": " + text);
    });

    chatForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = msgInput.value.trim();
      if (!text) return;
      socket.emit("chat", text);
      msgInput.value = "";
    });
  </script>
</body>
</html>