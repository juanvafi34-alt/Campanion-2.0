<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Campanion 2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background:#0A1A2F;
      color:#F0F4F8;
      margin:0;
      display:flex;
      justify-content:center;
    }
    .wrap { width: 92%; max-width: 900px; margin: 24px auto; }
    .card { background:#102A43; border:1px solid #1C3A57; border-radius:12px; padding:16px; }

    input, button {
      padding:10px;
      border-radius:8px;
      border:1px solid #1C3A57;
      background:#1C3A57;
      color:#F0F4F8;
      outline:none;
    }
    button { background:#1FA97B; border:none; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }

    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .row > * { flex: 1; min-width: 180px; }

    #chatUI { display:none; margin-top:14px; }
    #messages {
      list-style:none;
      padding:0;
      margin:0;
      height: 380px;
      overflow:auto;
      border:1px solid #1C3A57;
      border-radius:10px;
      background: rgba(0,0,0,0.05);
    }
    #messages li { padding:10px; border-bottom:1px solid #1C3A57; }
    .muted { color:#9FB3C8; font-size: 13px; }
    .err { color:#ffb4b4; margin-top:10px; }
    .ok { color:#9ff5d8; margin-top:10px; }

    form { margin-top:10px; display:flex; gap:10px; }
    form input { flex:1; }

    /* Tabs */
    .tabs { margin: 10px 0 14px; display:flex; gap:10px; }
    .tabs button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #1C3A57;
      background: #1C3A57;
      color: #F0F4F8;
      cursor: pointer;
    }
    .tabs button.active { background: #1FA97B; border: none; color:#fff; }
    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>

<body>
  <div class="wrap">
    <h2>ðŸ’¬ Campanion 2.0</h2>

    <div class="tabs">
      <button id="tabChat" class="active">Chat</button>
      <button id="tabAbout">About Us</button>
    </div>

    <!-- CHAT SECTION -->
    <div id="sectionChat" class="section active">
      <div class="card" id="joinCard">
        <div class="row">
          <div>
            <label class="muted">Your name</label><br/>
            <input id="name" type="text" placeholder="Juan" />
          </div>
          <div>
            <label class="muted">Room code</label><br/>
            <input id="code" type="text" placeholder="PINE123" />
          </div>
          <div style="display:flex; align-items:flex-end;">
            <button id="joinBtn">Join room</button>
          </div>
        </div>
        <div class="muted" style="margin-top:10px;">
          Try codes: <b>BOWMAN123</b>, <b>WATSON123</b>, <b>JUAN123</b>
        </div>
        <div id="status" class="err" style="display:none;"></div>
      </div>

      <div class="card" id="chatUI">
        <div class="muted" id="roomLabel"></div>
        <ul id="messages"></ul>

        <form id="chatForm">
          <input id="msg" type="text" placeholder="Type a message..." autocomplete="off" />
          <button type="submit">Send</button>
        </form>

        <div style="margin-top:10px;">
          <button id="leaveBtn" style="background:#1C3A57;">Leave room</button>
        </div>
      </div>
    </div>

    <!-- ABOUT SECTION -->
    <div id="sectionAbout" class="section">
      <div class="card">
        <h3>About Us</h3>

        <p class="muted">Hi! Iâ€™m Juan Vasquez, the creator of Campanion.</p>

        <p>
          Campanion was created to give people the chance to get to know other people when they go camping!
          Get to know the people on the campsite, campsite updates, and a way to share your experiences with other people.
        </p>

        <p>
          This is the second version of Campanion. Campanion is still in development and there are more features on the way.
        </p>

        <p class="muted">
          Want to give feedback or contact us? Email: juan_vasqu982@ahschools.us
        </p>
      </div>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
  <script>
    // âœ… Always connect to your Render backend (change if your Render URL changes)
    const SERVER_URL = "https://campanion-2-0.onrender.com";
    const socket = io(SERVER_URL, { transports: ["websocket", "polling"] });

    // --- TAB SYSTEM ---
    const tabChat = document.getElementById("tabChat");
    const tabAbout = document.getElementById("tabAbout");
    const sectionChat = document.getElementById("sectionChat");
    const sectionAbout = document.getElementById("sectionAbout");

    function showTab(which) {
      const chatActive = which === "chat";
      sectionChat.classList.toggle("active", chatActive);
      sectionAbout.classList.toggle("active", !chatActive);

      tabChat.classList.toggle("active", chatActive);
      tabAbout.classList.toggle("active", !chatActive);
    }

    tabChat.onclick = () => showTab("chat");
    tabAbout.onclick = () => showTab("about");
    // --- END TAB SYSTEM ---

    const joinBtn = document.getElementById("joinBtn");
    const leaveBtn = document.getElementById("leaveBtn");
    const statusEl = document.getElementById("status");
    const chatUI = document.getElementById("chatUI");
    const joinCard = document.getElementById("joinCard");
    const roomLabel = document.getElementById("roomLabel");
    const messages = document.getElementById("messages");
    const chatForm = document.getElementById("chatForm");
    const msgInput = document.getElementById("msg");

    let currentRoom = "";

    function setStatus(text, ok=false) {
      statusEl.style.display = "block";
      statusEl.className = ok ? "ok" : "err";
      statusEl.textContent = text;
    }

    function addLine(text, muted=false) {
      const li = document.createElement("li");
      li.textContent = text;
      if (muted) li.style.opacity = 0.8;
      messages.appendChild(li);
      messages.scrollTop = messages.scrollHeight;
    }

    joinBtn.onclick = () => {
      const name = document.getElementById("name").value.trim() || "Anonymous";
      const code = document.getElementById("code").value.trim().toUpperCase();

      if (!code) return setStatus("Enter a room code.");
      statusEl.style.display = "none";

      socket.emit("joinRoom", { name, code });
    };

    leaveBtn.onclick = () => {
      if (!currentRoom) return;
      socket.emit("leaveRoom");
      currentRoom = "";
      messages.innerHTML = "";
      chatUI.style.display = "none";
      joinCard.style.display = "block";
      setStatus("Left room.", true);
    };

    socket.on("connect", () => {
      // Optional debug:
      // console.log("Connected:", socket.id);
    });

    socket.on("invalidRoom", () => {
      setStatus("Invalid room code. Try PINE123 / LAKE777 / CAMP999");
    });

    socket.on("joined", (code) => {
      currentRoom = code;
      joinCard.style.display = "none";
      chatUI.style.display = "block";
      roomLabel.textContent = "Room: " + code;
      messages.innerHTML = "";
      addLine("âœ… Joined room " + code, true);
    });

    socket.on("system", (text) => addLine("â€¢ " + text, true));

    socket.on("chat", ({ name, text }) => {
      addLine(name + ": " + text);
    });

    socket.on("disconnect", () => {
      // If server disconnects, user will need to rejoin
      // Optional:
      // setStatus("Disconnected from server.", false);
    });

    chatForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = msgInput.value.trim();
      if (!text) return;
      socket.emit("chat", text);
      msgInput.value = "";
    });
  </script>
</body>
</html>